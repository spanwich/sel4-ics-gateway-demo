# Snort Configuration - Enhanced ICS/SCADA Protection
# Digital Bond Quickdraw + Custom CVE Detection Rules
#
# Profile: enhanced
# Rules: Quickdraw + Custom Modbus CVE rules
# CVEs Detected:
#   - CVE-2019-14462 (libmodbus heap overflow)
#   - CVE-2022-0367 (libmodbus heap underflow)
#   - CVE-2022-20685 (Snort preprocessor vulnerability)

#--------------------------------------------------
# Network Variables
#--------------------------------------------------
ipvar HOME_NET 192.168.95.0/24
ipvar EXTERNAL_NET !$HOME_NET
ipvar MODBUS_SERVER 192.168.95.2
ipvar MODBUS_CLIENT any
portvar MODBUS_PORTS 502

#--------------------------------------------------
# Path Variables
#--------------------------------------------------
var RULE_PATH /etc/snort/rules
var SO_RULE_PATH /etc/snort/so_rules
var PREPROC_RULE_PATH /etc/snort/preproc_rules
var WHITE_LIST_PATH /etc/snort/rules
var BLACK_LIST_PATH /etc/snort/rules

#--------------------------------------------------
# Dynamic Libraries
#--------------------------------------------------
dynamicpreprocessor directory /usr/local/lib/snort_dynamicpreprocessor/
dynamicengine /usr/local/lib/snort_dynamicengine/libsf_engine.so

#--------------------------------------------------
# Decoder Configuration
#--------------------------------------------------
config disable_decode_alerts
config disable_tcpopt_experimental_alerts
config disable_tcpopt_obsolete_alerts
config disable_tcpopt_ttcp_alerts
config disable_tcpopt_alerts
config disable_ipopt_alerts
config checksum_mode: all

#--------------------------------------------------
# Inline Mode (IPS)
#--------------------------------------------------
config policy_mode: inline

#--------------------------------------------------
# Detection Engine
#--------------------------------------------------
config detection: search-method ac-bnfa search-optimize max-pattern-len 20
config event_queue: max_queue 8 log 5 order_events content_length

#--------------------------------------------------
# Performance Configuration
#--------------------------------------------------
config paf_max: 16000

#--------------------------------------------------
# Preprocessors
#--------------------------------------------------
preprocessor stream5_global: \
    track_tcp yes, \
    track_udp yes, \
    track_icmp no, \
    max_tcp 262144, \
    max_udp 131072, \
    max_active_responses 2, \
    min_response_seconds 5

preprocessor stream5_tcp: \
    policy windows, \
    detect_anomalies, \
    require_3whs 180, \
    overlap_limit 10, \
    small_segments 3 bytes 150, \
    timeout 180, \
    ports client 502, \
    ports server 502

preprocessor stream5_udp: timeout 180

preprocessor frag3_global: max_frags 65536
preprocessor frag3_engine: policy windows detect_anomalies overlap_limit 10 min_fragment_length 100 timeout 180

#--------------------------------------------------
# SCADA/ICS Preprocessors
#--------------------------------------------------
preprocessor modbus: ports { 502 }
preprocessor dnp3: ports { 20000 } memcap 262144 check_crc

#--------------------------------------------------
# Output Configuration
#--------------------------------------------------
output alert_fast: stdout
output log_tcpdump: snort.pcap

#--------------------------------------------------
# Classification Config
#--------------------------------------------------
include /etc/snort/classification.config

#--------------------------------------------------
# Rules - Enhanced ICS Protection
#--------------------------------------------------
# Industry standard ICS detection rules
include $RULE_PATH/quickdraw.rules

# Custom CVE detection rules (CVE-2019-14462, CVE-2022-0367, CVE-2022-20685)
include $RULE_PATH/modbus.rules

