# Snort Configuration - Talos ICS/SCADA Rules
# Cisco Talos PROTOCOL-SCADA ruleset
#
# Profile: talos
# Rules: Talos PROTOCOL-SCADA (subscription required)
#
# NOTE: Talos rules require a subscription from https://snort.org/products
#       Personal: $29/year, Business pricing available
#
# After subscribing, download rules and extract to $RULE_PATH:
#   - protocol-scada.rules (main SCADA/ICS rules)
#   - community.rules (free community rules)
#
# Coverage includes:
#   - Modbus protocol anomalies
#   - DNP3 protocol attacks
#   - ICS vendor-specific vulnerabilities (Schneider, Rockwell, Siemens)
#   - Default credential detection

#--------------------------------------------------
# Network Variables
#--------------------------------------------------
ipvar HOME_NET 192.168.95.0/24
ipvar EXTERNAL_NET !$HOME_NET
ipvar MODBUS_SERVER 192.168.95.2
ipvar MODBUS_CLIENT any
portvar MODBUS_PORTS 502
portvar DNP3_PORTS 20000

#--------------------------------------------------
# Path Variables
#--------------------------------------------------
var RULE_PATH /etc/snort/rules
var SO_RULE_PATH /etc/snort/so_rules
var PREPROC_RULE_PATH /etc/snort/preproc_rules
var WHITE_LIST_PATH /etc/snort/rules
var BLACK_LIST_PATH /etc/snort/rules

#--------------------------------------------------
# Dynamic Libraries
#--------------------------------------------------
dynamicpreprocessor directory /usr/local/lib/snort_dynamicpreprocessor/
dynamicengine /usr/local/lib/snort_dynamicengine/libsf_engine.so

#--------------------------------------------------
# Decoder Configuration
#--------------------------------------------------
config disable_decode_alerts
config disable_tcpopt_experimental_alerts
config disable_tcpopt_obsolete_alerts
config disable_tcpopt_ttcp_alerts
config disable_tcpopt_alerts
config disable_ipopt_alerts
config checksum_mode: all

#--------------------------------------------------
# Inline Mode (IPS)
#--------------------------------------------------
config policy_mode: inline

#--------------------------------------------------
# Detection Engine
#--------------------------------------------------
config detection: search-method ac-bnfa search-optimize max-pattern-len 20
config event_queue: max_queue 8 log 5 order_events content_length

#--------------------------------------------------
# Performance Configuration
#--------------------------------------------------
config paf_max: 16000

#--------------------------------------------------
# Preprocessors (Required for Talos SCADA rules)
#--------------------------------------------------
preprocessor stream5_global: \
    track_tcp yes, \
    track_udp yes, \
    track_icmp no, \
    max_tcp 262144, \
    max_udp 131072, \
    max_active_responses 2, \
    min_response_seconds 5

preprocessor stream5_tcp: \
    policy windows, \
    detect_anomalies, \
    require_3whs 180, \
    overlap_limit 10, \
    small_segments 3 bytes 150, \
    timeout 180, \
    ports client 502 20000, \
    ports server 502 20000

preprocessor stream5_udp: timeout 180

preprocessor frag3_global: max_frags 65536
preprocessor frag3_engine: policy windows detect_anomalies overlap_limit 10 min_fragment_length 100 timeout 180

#--------------------------------------------------
# SCADA/ICS Preprocessors
# Required for Talos PROTOCOL-SCADA rules using modbus_func, modbus_unit, modbus_data
#--------------------------------------------------
preprocessor modbus: ports { 502 }
preprocessor dnp3: ports { 20000 } memcap 262144 check_crc

#--------------------------------------------------
# Output Configuration
#--------------------------------------------------
output alert_fast: stdout
output log_tcpdump: snort.pcap

#--------------------------------------------------
# Classification Config
#--------------------------------------------------
include /etc/snort/classification.config

#--------------------------------------------------
# Talos PROTOCOL-SCADA Rules
# Uncomment after downloading from snort.org
#--------------------------------------------------
# include $RULE_PATH/protocol-scada.rules

#--------------------------------------------------
# Community Rules (free tier)
#--------------------------------------------------
# include $RULE_PATH/community.rules

#--------------------------------------------------
# Example Talos-style Rules (for reference)
# These demonstrate the modbus_func and modbus_unit options
#--------------------------------------------------
include $RULE_PATH/talos-examples.rules

